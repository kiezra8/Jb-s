<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JB'S COLLECTION - Luxury Fashion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Outfit:wght@300;400;600&display=swap');

        body {
            font-family: 'Outfit', sans-serif;
        }

        /* Advanced Animations */
        @keyframes slide {

            0%,
            25% {
                transform: translateX(0);
            }

            30%,
            55% {
                transform: translateX(-100%);
            }

            60%,
            85% {
                transform: translateX(-200%);
            }

            90%,
            100% {
                transform: translateX(-300%);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
            }

            to {
                transform: translateX(0);
            }
        }

        @keyframes slideInUp {
            from {
                transform: translateY(100%);
            }

            to {
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .animate-slide {
            animation: slide 20s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }

        .animate-fade-in-up {
            animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .animate-slide-in-right {
            animation: slideInRight 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .animate-slide-in-up {
            animation: slideInUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        .line-clamp-1 {
            display: -webkit-box;
            -webkit-line-clamp: 1;
            line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .brand-text {
            font-family: 'Playfair Display', serif;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* First Pharmacy / Luxury Animations */
        @keyframes subtle-drift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        @keyframes float-up {
            0% {
                transform: translateY(20px);
                opacity: 0;
            }

            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .animate-float-up {
            animation: float-up 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        .bg-luxury {
            background: linear-gradient(-45deg, #fdfbfb, #ebedee, #f3e7e9, #e3eeff);
            background-size: 400% 400%;
            animation: subtle-drift 15s ease infinite;
        }

        @keyframes pop-in {
            0% {
                opacity: 0;
                transform: scale(0.9) translateY(10px);
            }

            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        @keyframes slide-up-elastic {
            0% {
                opacity: 0;
                transform: translateY(30px);
            }

            60% {
                transform: translateY(-5px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-pop-card {
            animation: pop-in 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .animate-list-item {
            opacity: 0;
            /* Star hidden */
            animation: slide-up-elastic 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        /* Pharmacy Style Solid Bars */
        .action-bar {
            background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
            color: white;
            border-radius: 1rem;
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.3);
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .action-bar:active {
            transform: scale(0.97);
        }

        /* Rounded Banner Style */
        .feature-banner {
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.08);
            transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .glass-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.12);
            border-color: rgba(255, 255, 255, 0.9);
        }

        .animate-slide-up-stagger {
            opacity: 0;
            animation: float-up 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        /* Override standard scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        @keyframes hero-slide {

            0%,
            20% {
                transform: translateX(0%);
            }

            25%,
            45% {
                transform: translateX(-25%);
            }

            50%,
            70% {
                transform: translateX(-50%);
            }

            75%,
            95% {
                transform: translateX(-75%);
            }

            100% {
                transform: translateX(0%);
            }
        }

        .animate-hero-slide {
            animation: hero-slide 16s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }
    </style>
</head>

<body class="bg-luxury text-gray-800 antialiased selection:bg-pink-100 selection:text-pink-900">
    <div id="app"></div>

    <script>
        const ADMIN_EMAIL = 'israelezrakisakye@gmail.com';

        const state = {
            activeTab: 'home',
            cart: JSON.parse(localStorage.getItem('jbs_cart') || '[]'),
            showCart: false,
            showMenu: false,
            selectedCategory: 'all',
            selectedProduct: null,
            selectedSize: '',
            searchQuery: '',
            showOrderOptions: false,
            orderProduct: null,
            viewingCategoryPage: false,
            // Auth & Messaging
            currentUser: null,
            isAdmin: false,
            showAuthModal: false,
            authMode: 'login', // 'login' or 'signup'
            orders: [],
            messages: [],
            selectedOrder: null,
            selectedConversation: null,
            unreadCount: 0
        };

        const categories = [
            { id: 'all', name: 'All', image: 'https://loremflickr.com/800/800/fashion?lock=200' },
            { id: 'women', name: 'Women', image: 'https://i.pinimg.com/736x/95/44/a5/9544a5e02df35bab2288c2500cd222b5.jpg' },
            { id: 'men', name: 'Men', image: 'https://i.pinimg.com/236x/10/f4/34/10f4347df4f17731d246e1c6f4e05da5.jpg' },
            { id: 'children', name: 'Children', image: 'https://i.pinimg.com/736x/84/17/59/841759f114df190b086c4eb2552f946a.jpg' },
            { id: 'babies', name: 'Babies', image: 'https://i.pinimg.com/236x/80/6d/69/806d69a7d33066c1d873928d5ad97a4e.jpg' },
            { id: 'bridal', name: 'Bridal', image: 'data:image/jpeg;base64,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' },
            { id: 'cultural', name: 'Cultural', image: 'https://www.ugabox.com/images/business/directory/bridal-fashion/her-collection/traditional-wear-02.jpg' },
            { id: 'underwear', name: 'Underwear', image: 'https://img4.dhresource.com/webp/m/0x0/f3/albu/jc/n/23/4b8fb85d-c715-4e5c-9ff6-6778b4ff3623.jpg' },
            { id: 'nightwear', name: 'Nightwear', image: 'https://pictures-nigeria.jijistatic.net/188185150_NjIwLTExMDItZjE1NThkY2UyYw.webp' },
            { id: 'sportswear', name: 'Sportswear', image: 'https://s.alicdn.com/@sc04/kf/H18617761cf8d40bda36a15afda1b89d8Q/Thai-Quality-100-Polyester-Soccer-Tracksuit-Training-Suit-Player-Football-Team-Tracksuits-Football-Jacket-for-Men.jpg_300x300.jpg' },
            { id: 'shoes', name: 'Shoes', image: 'https://inc5shop.com/cdn/shop/files/INC-800627_Black_1_91d145d6-6656-4178-9ea6-4fc00f285455.jpg?v=1755493876' },
            { id: 'accessories', name: 'Accessories', image: 'https://loremflickr.com/800/800/luxury,watch?lock=211' },
            { id: 'muslim', name: 'Muslim Wears', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS5YNYht5Ur8Ta_L_itT0Z9AEmxdk2vjTql1g&s' }
        ];


        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD3KkDY9wJiGG_P5JaFuJcNfwn_gQmKbME",
            authDomain: "jb-s-72a95.firebaseapp.com",
            projectId: "jb-s-72a95",
            storageBucket: "jb-s-72a95.firebasestorage.app",
            messagingSenderId: "1029813117482",
            appId: "1:1029813117482:web:73f840608b7e5702ef5953",
            measurementId: "G-C0BMZ4HSKZ"
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase initialized");

            // Auth state listener
            firebase.auth().onAuthStateChanged(async (user) => {
                if (user) {
                    state.currentUser = user;
                    state.isAdmin = user.email === ADMIN_EMAIL;
                    console.log(`Logged in as: ${user.email}`, state.isAdmin ? '(ADMIN)' : '(Customer)');
                    await loadUserData();
                } else {
                    state.currentUser = null;
                    state.isAdmin = false;
                }
                render();
            });

            // Load products
            initializeApp();
        } catch (e) {
            console.warn("Firebase config missing or invalid", e);
        }

        let products = [];

        // Auth Functions
        async function login(email, password) {
            try {
                await firebase.auth().signInWithEmailAndPassword(email, password);
                state.showAuthModal = false;
                showToast('Welcome back!');
            } catch (error) {
                alert('Login failed: ' + error.message);
            }
        }

        async function signup(email, password, name) {
            try {
                const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                await userCredential.user.updateProfile({ displayName: name });

                // Create user document
                const db = firebase.firestore();
                await db.collection('users').doc(userCredential.user.uid).set({
                    email,
                    name,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                state.showAuthModal = false;
                showToast('Account created successfully!');
            } catch (error) {
                alert('Signup failed: ' + error.message);
            }
        }

        async function logout() {
            try {
                await firebase.auth().signOut();
                state.cart = [];
                state.orders = [];
                state.messages = [];
                showToast('Logged out successfully');
            } catch (error) {
                alert('Logout failed: ' + error.message);
            }
        }

        async function loadUserData() {
            if (!state.currentUser) return;

            const db = firebase.firestore();

            // Load user's orders
            if (state.isAdmin) {
                // Admin sees all orders
                const ordersSnapshot = await db.collection('orders').orderBy('createdAt', 'desc').get();
                state.orders = ordersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            } else {
                // Customer sees only their orders
                const ordersSnapshot = await db.collection('orders')
                    .where('userId', '==', state.currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .get();
                state.orders = ordersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            }

            // Count unread messages
            state.unreadCount = state.orders.filter(o => o.unreadByCustomer && !state.isAdmin).length;
        }

        async function initializeApp() {
            // 1. Try to get products from Firestore
            if (typeof firebase !== 'undefined' && firebase.apps.length > 0) {
                try {
                    const db = firebase.firestore();
                    const snapshot = await db.collection('products').get();

                    if (!snapshot.empty) {
                        console.log('Loaded products from Firestore');
                        products = snapshot.docs.map(doc => doc.data());
                        render();
                    } else {
                        console.log('Database empty. Seeding...');
                        generateProducts(); // Generate local
                        await seedDatabase(db); // Upload to firestore
                    }
                } catch (e) {
                    console.warn('Firestore Error (Check Config):', e);
                    console.log('Falling back to local mode');
                    generateProducts();
                }
            } else {
                console.log('Firebase not initialized. Using local mode.');
                generateProducts();
            }
            render();
        }

        async function seedDatabase(db) {
            const batch = db.batch();
            products.forEach(product => {
                const ref = db.collection('products').doc(product.id.toString());
                batch.set(ref, product);
            });
            try {
                await batch.commit();
                showToast('Database Seeded Successfully!');
            } catch (err) {
                console.error('Error seeding:', err);
                showToast('Error seeding database');
            }
        }

        function generateProducts() {
            let idCounter = 1;
            const adjectives = ['Elegant', 'Modern', 'Classic', 'Luxury', 'Casual', 'Stylish', 'Premium', 'Urban', 'Summer', 'Cozy', 'Chic', 'Vintage', 'Designer', 'Essential', 'Sleek'];

            const categoryConfig = {
                'women': { base: ['Dress', 'Blouse', 'Skirt', 'Jeans', 'Jacket', 'Coat', 'Top', 'Suit'], priceRange: [50000, 300000], sizes: ['XS', 'S', 'M', 'L', 'XL'] },
                'men': { base: ['Shirt', 'Trousers', 'Suit', 'Jeans', 'Jacket', 'Blazer', 'Polo', 'Chinos'], priceRange: [60000, 500000], sizes: ['S', 'M', 'L', 'XL', 'XXL'] },
                'children': { base: ['T-Shirt', 'Dress', 'Shorts', 'Pants', 'Set', 'Jacket', 'Uniform', 'Sweater'], priceRange: [30000, 150000], sizes: ['4-5Y', '6-7Y', '8-9Y', '10-11Y'] },
                'babies': { base: ['Onesie', 'Sleepsuit', 'Romper', 'Set', 'Bib', 'Blanket', 'Bodysuit'], priceRange: [25000, 100000], sizes: ['0-3M', '3-6M', '6-9M', '9-12M'] },
                'bridal': { base: ['Wedding Gown', 'Bridesmaid Dress', 'Veil', 'Tiara', 'Robe', 'Clutch'], priceRange: [500000, 5000000], sizes: ['S', 'M', 'L', 'XL'] },
                'cultural': { base: ['Kanzu', 'Gomesi', 'Kitenge', 'Kaftan', 'Dashiki', 'Headwrap'], priceRange: [150000, 800000], sizes: ['Free Size', 'S', 'M', 'L', 'XL'] },
                'underwear': { base: ['Briefs', 'Boxers', 'Panties', 'Bra', 'Lingerie Set', 'Vest'], priceRange: [20000, 150000], sizes: ['S', 'M', 'L', 'XL'] },
                'nightwear': { base: ['Pajamas', 'Nightgown', 'Robe', 'Sleep Shorts', 'Silk Set'], priceRange: [50000, 250000], sizes: ['S', 'M', 'L', 'XL'] },
                'sportswear': { base: ['Jersey', 'Tracksuit', 'Leggings', 'Sports Bra', 'Shorts', 'Running Jacket'], priceRange: [70000, 350000], sizes: ['S', 'M', 'L', 'XL'] },
                'shoes': { base: ['Sneakers', 'Boots', 'Heels', 'Sandals', 'Loafers', 'Oxfords', 'Flats'], priceRange: [100000, 600000], sizes: ['38', '39', '40', '41', '42', '43'] },
                'accessories': { base: ['Watch', 'Belt', 'Tie', 'Handbag', 'Sunglasses', 'Scarf', 'Hat', 'Jewelry Set'], priceRange: [50000, 1000000], sizes: ['One Size'] },
                'muslim': { base: ['Abaya', 'Hijab', 'Thobe', 'Kaftan', 'Jilbab', 'Tunic', 'Scarf', 'Prayer Dress'], priceRange: [40000, 300000], sizes: ['S', 'M', 'L', 'XL', 'XXL'] }
            };

            const imageKeywords = {
                'women': 'woman,dress',
                'men': 'man,fashion',
                'children': 'child,fashion',
                'babies': 'baby,cute',
                'bridal': 'wedding,dress',
                'cultural': 'traditional,clothing',
                'underwear': 'lingerie,underwear',
                'nightwear': 'pajamas,sleepwear',
                'sportswear': 'sportswear,fitness',
                'shoes': 'shoes,footwear',
                'accessories': 'watch,handbag',
                'muslim': 'muslim,fashion'
            };

            categories.forEach(cat => {
                if (cat.id === 'all') return;
                const config = categoryConfig[cat.id] || { base: ['Item'], priceRange: [50000, 100000], sizes: ['M'] };
                const keywords = imageKeywords[cat.id] || 'fashion';

                for (let i = 0; i < 50; i++) {
                    const adj = adjectives[Math.floor(Math.random() * adjectives.length)];
                    const base = config.base[Math.floor(Math.random() * config.base.length)];
                    const price = Math.floor(Math.random() * (config.priceRange[1] - config.priceRange[0]) + config.priceRange[0]);
                    const finalPrice = Math.round(price / 1000) * 1000;

                    products.push({
                        id: idCounter++,
                        name: `${adj} ${base}`,
                        price: finalPrice,
                        // High Quality HD image (800x800)
                        image: `https://loremflickr.com/800/800/${keywords}?lock=${idCounter}`,
                        category: cat.id,
                        rating: (3.5 + Math.random() * 1.5).toFixed(1),
                        reviews: Math.floor(Math.random() * 500) + 10,
                        sizes: config.sizes
                    });
                }
            });
        }

        initializeApp();

        function formatMoney(amount) {
            return 'UGX ' + amount.toLocaleString('en-UG');
        }

        function saveState() {
            localStorage.setItem('jbs_cart', JSON.stringify(state.cart));
            localStorage.setItem('jbs_favorites', JSON.stringify(state.favorites));
        }

        function getFilteredProducts() {
            // If searching, search EVERYTHING (ignore current category filter)
            if (state.searchQuery) {
                return products.filter(p => p.name.toLowerCase().includes(state.searchQuery.toLowerCase()));
            }
            // Otherwise, filter by category
            return state.selectedCategory === 'all' ? products : products.filter(p => p.category === state.selectedCategory);
        }

        function toggleFavorite(productId) {
            const index = state.favorites.indexOf(productId);
            if (index > -1) {
                state.favorites.splice(index, 1);
            } else {
                state.favorites.push(productId);
            }
            saveState();
            render();
        }


        async function placeOrder() {
            if (!state.currentUser) {
                state.showAuthModal = true;
                state.showOrderOptions = false;
                showToast('Please login to place an order');
                return;
            }

            const product = state.orderProduct;
            const db = firebase.firestore();

            try {
                const orderData = {
                    userId: state.currentUser.uid,
                    userEmail: state.currentUser.email,
                    userName: state.currentUser.displayName || 'Customer',
                    product: {
                        id: product.id,
                        name: product.name,
                        price: product.price,
                        image: product.image
                    },
                    items: product.context === 'order' ? state.cart : [product],
                    total: product.context === 'order' ? product.price : product.price,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    messages: [],
                    unreadByAdmin: true,
                    unreadByCustomer: false
                };

                const orderRef = await db.collection('orders').add(orderData);

                state.showOrderOptions = false;
                state.activeTab = 'messages';
                state.selectedOrder = orderRef.id;
                await loadUserData();
                showToast('Order placed! Chat with admin below.');
                render();
            } catch (error) {
                alert('Order failed: ' + error.message);
            }
        }

        function addToCart(product, size) {
            if (!size) {
                alert('Please select a size');
                return;
            }
            const existing = state.cart.find(item => item.id === product.id && item.selectedSize === size);
            if (existing) {
                existing.quantity += 1;
            } else {
                state.cart.push({ ...product, selectedSize: size, quantity: 1 });
            }
            state.selectedProduct = null;
            state.selectedSize = '';
            saveState();
            render();
            showToast('Added to cart!');
        }

        function removeFromCart(productId, size) {
            state.cart = state.cart.filter(item => !(item.id === productId && item.selectedSize === size));
            saveState();
            render();
        }

        function updateQuantity(productId, size, delta) {
            const item = state.cart.find(item => item.id === productId && item.selectedSize === size);
            if (item) {
                item.quantity += delta;
                if (item.quantity <= 0) {
                    removeFromCart(productId, size);
                } else {
                    saveState();
                    render();
                }
            }
        }

        function getTotalPrice() {
            return state.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-20 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-6 py-3 rounded-full shadow-lg z-50 animate-fade-in-up';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2000);
        }

        const getImg = (p) => p.image.startsWith('http') ? p.image : `https://loremflickr.com/400/400/fashion?lock=${p.id || 999}`;

        function renderProductCard(product, index = 0) {
            return `
                <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow glass-card animate-fade-in-up" style="animation-delay: ${index * 50}ms">
                    <div onclick="selectProduct(${product.id})" class="cursor-pointer">
                        <div class="relative h-48 bg-gray-100 group overflow-hidden">
                            <img src="${product.image}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                            <button onclick="event.stopPropagation(); toggleFavorite(${product.id})" class="absolute top-2 right-2 bg-white rounded-full p-2 shadow-md hover:scale-110 active:scale-95 transition-transform">
                                <i data-lucide="heart" class="w-5 h-5 ${state.favorites.includes(product.id) ? 'fill-red-500 text-red-500' : 'text-gray-400'}"></i>
                            </button>
                            <button onclick="event.stopPropagation(); selectProduct(${product.id})" class="absolute bottom-2 right-2 bg-white rounded-full p-2 shadow-md hover:scale-110 active:scale-95 transition-transform text-pink-600">
                                <i data-lucide="plus" class="w-5 h-5"></i>
                            </button>
                        </div>
                        <div class="p-3">
                            <h3 class="font-semibold text-sm mb-1 line-clamp-2">${product.name}</h3>
                            <div class="flex items-center gap-1 mb-2">
                                <i data-lucide="star" class="w-4 h-4 fill-yellow-400 text-yellow-400"></i>
                                <span class="text-xs text-gray-600">${product.rating}</span>
                                <span class="text-xs text-gray-400">(${product.reviews})</span>
                            </div>
                            <div class="text-lg font-bold text-pink-600 mb-2">${formatMoney(product.price)}</div>
                        </div>
                    </div>
                    <div class="px-3 pb-3">
                        <button onclick='showOrderOptions(${JSON.stringify(product).replace(/'/g, "&#39;")}, "buy")' class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-2.5 rounded-lg font-bold text-sm shadow-lg hover:shadow-xl active:scale-95 transition-all">
                            BUY NOW
                        </button>
                    </div>
                </div>
            `;
        }

        function renderHome() {
            if (state.searchQuery) {
                const filteredProducts = getFilteredProducts();
                return `
                    <div class="flex-1 overflow-y-auto bg-gray-50 pb-20 p-4 animate-fade-in">
                        <div class="mb-4 flex items-center justify-between">
                            <h2 class="text-xl font-bold text-gray-800">Search Results</h2>
                            <span class="text-sm text-gray-500">${filteredProducts.length} found</span>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            ${filteredProducts.length > 0 ? filteredProducts.map((p, i) => renderProductCard(p, i)).join('') : `
                                <div class="col-span-2 text-center py-20 text-gray-500 animate-fade-in-up">
                                    <i data-lucide="search-x" class="w-16 h-16 mx-auto mb-4 text-gray-300"></i>
                                    <p class="text-lg">No products found matching "${state.searchQuery}"</p>
                                </div>
                            `}
                        </div>
                    </div>
                `;
            }

            if (state.viewingCategoryPage && state.selectedCategory !== 'all') {
                const filteredProducts = getFilteredProducts();
                const category = categories.find(c => c.id === state.selectedCategory);
                return `
                    <div class="flex-1 overflow-y-auto bg-gray-50 pb-20 p-4 animate-fade-in">
                        <div class="flex items-center gap-2 mb-6 cursor-pointer hover:opacity-80 transition-opacity" onclick="backToHome()">
                            <i data-lucide="arrow-left" class="w-6 h-6 text-gray-600"></i>
                            <h2 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-pink-600 to-purple-600">${category.name} Collection</h2>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            ${filteredProducts.length > 0 ? filteredProducts.map((p, i) => renderProductCard(p, i)).join('') : `
                                <div class="col-span-2 text-center py-20 text-gray-500 animate-fade-in-up">
                                    <p>No products found in this collection.</p>
                                </div>
                            `}
                        </div>
                    </div>
                `;
            }

            return `
                <div class="flex-1 overflow-y-auto bg-gray-50 pb-20 animate-fade-in">
                    <div class="p-4 pb-0">
                        <!-- Hero Carousel (Pharmacy Style) -->
                        <div class="feature-banner overflow-hidden relative h-56 w-full animate-pop-card bg-gray-100">
                            <div class="flex w-[400%] h-full animate-hero-slide">
                                <!-- Slide 1: Delivery -->
                                <div class="w-1/4 relative h-full">
                                    <img src="https://loremflickr.com/800/400/delivery,truck?lock=1" class="absolute inset-0 w-full h-full object-cover">
                                    <div class="absolute inset-0 bg-gradient-to-r from-blue-600/90 to-indigo-700/40 p-6 flex flex-col justify-center text-white">
                                        <h3 class="text-3xl font-bold mb-2 leading-tight drop-shadow-md">Fast Delivery</h3>
                                        <p class="mb-4 font-medium opacity-95 text-lg">Countrywide shipping direct to you</p>
                                        <button class="w-max bg-white text-blue-600 px-6 py-2 rounded-full font-bold shadow-lg hover:scale-105 active:scale-95 transition-transform flex items-center gap-2">
                                            Learn More <i data-lucide="truck" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                                <!-- Slide 2: Support -->
                                <div class="w-1/4 relative h-full">
                                    <img src="https://loremflickr.com/800/400/customer,service?lock=2" class="absolute inset-0 w-full h-full object-cover">
                                    <div class="absolute inset-0 bg-gradient-to-r from-teal-500/90 to-emerald-600/40 p-6 flex flex-col justify-center text-white">
                                        <h3 class="text-3xl font-bold mb-2 leading-tight drop-shadow-md">Quick Support</h3>
                                        <p class="mb-4 font-medium opacity-95 text-lg">24/7 Communication Team</p>
                                        <button class="w-max bg-white text-teal-600 px-6 py-2 rounded-full font-bold shadow-lg hover:scale-105 active:scale-95 transition-transform flex items-center gap-2">
                                            Chat Now <i data-lucide="message-circle" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                                 <!-- Slide 3: Tailors -->
                                <div class="w-1/4 relative h-full">
                                    <img src="https://loremflickr.com/800/400/tailor,sewing?lock=3" class="absolute inset-0 w-full h-full object-cover">
                                    <div class="absolute inset-0 bg-gradient-to-r from-pink-500/90 to-rose-600/40 p-6 flex flex-col justify-center text-white">
                                        <h3 class="text-3xl font-bold mb-2 leading-tight drop-shadow-md">Best Tailors</h3>
                                        <p class="mb-4 font-medium opacity-95 text-lg">Expert Custom Fitting & Design</p>
                                        <button class="w-max bg-white text-pink-600 px-6 py-2 rounded-full font-bold shadow-lg hover:scale-105 active:scale-95 transition-transform flex items-center gap-2">
                                            Book Tailor <i data-lucide="scissors" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                                <!-- Slide 4: Quality -->
                                <div class="w-1/4 relative h-full">
                                    <img src="https://loremflickr.com/800/400/silk,fabric?lock=4" class="absolute inset-0 w-full h-full object-cover">
                                    <div class="absolute inset-0 bg-gradient-to-r from-amber-500/90 to-orange-600/40 p-6 flex flex-col justify-center text-white">
                                        <h3 class="text-3xl font-bold mb-2 leading-tight drop-shadow-md">Premium Quality</h3>
                                        <p class="mb-4 font-medium opacity-95 text-lg">Finest Luxurious Fabrics</p>
                                        <button class="w-max bg-white text-amber-600 px-6 py-2 rounded-full font-bold shadow-lg hover:scale-105 active:scale-95 transition-transform flex items-center gap-2">
                                            Explore <i data-lucide="crown" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white mt-2 py-4" id="shop-section">
                        <div class="px-4 mb-3">
                            <h2 class="text-lg font-bold text-gray-800">üõç Shop by Category</h2>
                        </div>
                        <div class="px-4 grid grid-cols-4 gap-4">
                            ${categories.filter(cat => cat.id !== 'all').map((cat, i) => `
                                <button onclick="selectCategory('${cat.id}')" class="flex flex-col items-center gap-2 animate-fade-in-up" style="animation-delay: ${i * 50}ms">
                                    <div class="w-full aspect-square bg-gray-100 rounded-full flex items-center justify-center hover:shadow-lg transition-all overflow-hidden border-2 border-transparent hover:border-pink-500 hover:scale-105">
                                        <img src="${cat.image}" class="w-full h-full object-cover">
                                    </div>
                                    <span class="text-xs font-medium text-gray-700 text-center leading-tight">${cat.name}</span>
                                </button>
                            `).join('')}
                        </div>
                    </div>

                    <div class="p-4">
                        <div class="mb-4">
                            <h2 class="text-lg font-bold text-gray-800">‚ú® Recommended For You</h2>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            ${getFilteredProducts().map((p, i) => renderProductCard(p, i)).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCategories() {
            return `
                <div class="flex-1 overflow-y-auto bg-gray-50 p-4 pb-20 animate-fade-in">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 px-1 animate-fade-in-up">Explore Collections</h2>
                    <div class="space-y-6">
                        ${categories.filter(cat => cat.id !== 'all').map((category, i) => `
                            <button onclick="selectCategory('${category.id}')" class="w-full relative h-48 rounded-2xl overflow-hidden shadow-lg group transform transition-all duration-500 hover:scale-[1.02] animate-fade-in-up" style="animation-delay: ${i * 50}ms">
                                <img src="${category.image}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                                <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent flex items-end p-6">
                                    <div class="w-full flex items-center justify-between">
                                        <div class="text-left transform transition-transform duration-300 group-hover:translate-x-2">
                                            <h3 class="text-white font-bold text-2xl mb-1">${category.name}</h3>
                                            <span class="text-gray-300 text-sm font-medium">View Collection</span>
                                        </div>
                                        <div class="w-10 h-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center group-hover:bg-white/30 transition-colors">
                                            <i data-lucide="arrow-right" class="w-5 h-5 text-white"></i>
                                        </div>
                                    </div>
                                </div>
                            </button>
                        `).join('')}
                    </div>
                </div>
                `;
        }

        function renderMessages() {
            if (!state.currentUser) {
                return `
                    <div class="flex-1 overflow-y-auto bg-gray-50 p-4 pb-20 animate-fade-in flex items-center justify-center">
                        <div class="text-center">
                            <i data-lucide="message-circle" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                            <p class="text-gray-500 mb-4">Please login to view messages</p>
                            <button onclick="state.showAuthModal = true; render();" class="bg-gradient-to-r from-pink-500 to-purple-600 text-white px-6 py-3 rounded-lg font-bold">
                                Login / Sign Up
                            </button>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="flex-1 overflow-y-auto bg-gray-50 p-4 pb-20 animate-fade-in">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 animate-fade-in-up">
                        ${state.isAdmin ? 'üì¶ All Orders' : 'üí¨ My Orders & Messages'}
                    </h2>
                    ${state.orders.length === 0 ? `
                        <div class="text-center py-16 animate-fade-in-up">
                            <i data-lucide="inbox" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                            <p class="text-gray-500">No orders yet</p>
                        </div>
                    ` : `
                        <div class="space-y-3">
                            ${state.orders.map((order, i) => `
                                <div onclick="selectOrder('${order.id}')" class="bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-all cursor-pointer animate-fade-in-up" style="animation-delay: ${i * 50}ms">
                                    <div class="flex items-start gap-3">
                                        <img src="${order.product?.image || order.items?.[0]?.image}" class="w-16 h-16 rounded-lg object-cover">
                                        <div class="flex-1">
                                            <div class="flex items-start justify-between mb-1">
                                                <h3 class="font-semibold text-sm">${order.product?.name || 'Order'}</h3>
                                                <span class="text-xs px-2 py-1 rounded-full ${order.status === 'pending' ? 'bg-yellow-100 text-yellow-700' :
                    order.status === 'confirmed' ? 'bg-green-100 text-green-700' :
                        order.status === 'cancelled' ? 'bg-red-100 text-red-700' :
                            'bg-blue-100 text-blue-700'
                }">${order.status}</span>
                                            </div>
                                            <p class="text-xs text-gray-500 mb-2">${state.isAdmin ? order.userName : formatMoney(order.total)}</p>
                                            <div class="flex items-center justify-between">
                                                <span class="text-xs text-gray-400">${order.createdAt ? new Date(order.createdAt.seconds * 1000).toLocaleDateString() : 'Just now'}</span>
                                                ${(state.isAdmin && order.unreadByAdmin) || (!state.isAdmin && order.unreadByCustomer) ?
                    '<span class="w-2 h-2 bg-pink-500 rounded-full"></span>' : ''
                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `}
                </div>
                `;
        }

        function renderProfile() {
            return `
                <div class="flex-1 overflow-y-auto bg-gray-50 pb-20 animate-fade-in">
                    <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-8 text-center rounded-b-3xl shadow-lg relative overflow-hidden">
                        <div class="w-24 h-24 bg-white rounded-full mx-auto mb-4 flex items-center justify-center shadow-lg border-4 border-white/20 relative z-10 animate-fade-in-up">
                            <i data-lucide="user" class="w-12 h-12 text-pink-500"></i>
                        </div>
                        <h2 class="text-2xl font-bold mb-1 relative z-10 animate-fade-in-up delay-100">
                            ${state.currentUser ? (state.currentUser.displayName || 'Welcome!') : 'Welcome!'}
                        </h2>
                        <p class="text-sm opacity-90 relative z-10 animate-fade-in-up delay-200">
                            ${state.currentUser ? state.currentUser.email : 'Please login to continue'}
                        </p>
                        ${state.isAdmin ? '<span class="inline-block bg-yellow-400 text-gray-900 px-3 py-1 rounded-full text-xs font-bold mt-2">ADMIN</span>' : ''}
                        <div class="absolute inset-0 bg-white/10 blur-xl"></div>
                    </div>
                    <div class="p-6 space-y-4 -mt-4 relative z-10">
                        ${state.currentUser ? `
                            <button onclick="switchTab('messages')" class="action-bar w-full p-4 flex items-center justify-between animate-list-item delay-100">
                                <div class="flex items-center gap-4">
                                    <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center">
                                        <i data-lucide="package" class="w-5 h-5 text-white"></i>
                                    </div>
                                    <span class="font-bold text-lg">My Orders</span>
                                </div>
                                <i data-lucide="arrow-right" class="w-5 h-5 text-white/80"></i>
                            </button>
                            
                            <button class="action-bar w-full p-4 flex items-center justify-between animate-list-item delay-200">
                                <div class="flex items-center gap-4">
                                    <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center">
                                        <i data-lucide="settings" class="w-5 h-5 text-white"></i>
                                    </div>
                                    <span class="font-bold text-lg">Settings</span>
                                </div>
                                <i data-lucide="arrow-right" class="w-5 h-5 text-white/80"></i>
                            </button>

                            <button onclick="logout()" class="w-full bg-red-500 hover:bg-red-600 text-white p-4 rounded-lg font-bold flex items-center justify-center gap-3 transition-all active:scale-95 animate-list-item delay-300">
                                <i data-lucide="log-out" class="w-5 h-5"></i>
                                Logout
                            </button>
                        ` : `
                            <button onclick="state.showAuthModal = true; render();" class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white p-4 rounded-lg font-bold flex items-center justify-center gap-3 transition-all active:scale-95 animate-list-item delay-100">
                                <i data-lucide="log-in" class="w-5 h-5"></i>
                                Login / Sign Up
                            </button>
                        `}
                    </div>
                </div>
                `;
        }

        function render() {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="flex flex-col h-screen bg-gray-50">
                    <!--Header -->
                <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-4 shadow-lg sticky top-0 z-30 transition-all duration-300">
                    <div class="flex items-center justify-between mb-3">
                        <i data-lucide="menu" class="w-6 h-6 cursor-pointer hover:rotate-90 transition-transform duration-300" onclick="toggleMenu()"></i>
                        <h1 class="text-xl font-bold brand-text tracking-widest text-center flex-1 animate-fade-in">JB'S COLLECTION</h1>
                        <div class="relative">
                            <i data-lucide="shopping-cart" class="w-6 h-6 cursor-pointer hover:scale-110 transition-transform active:scale-90" onclick="toggleCart()"></i>
                            ${state.cart.length > 0 ? `<span class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold animate-bounce shadow-sm">${state.cart.length}</span>` : ''}
                        </div>
                    </div>
                    <div class="relative animate-fade-in">
                        <i data-lucide="search" class="absolute left-3 top-2.5 w-5 h-5 text-gray-400"></i>
                        <input type="text" placeholder="Search..." value="${state.searchQuery}" oninput="handleSearch(event)" class="w-full pl-10 pr-4 py-2 rounded-full text-gray-800 focus:outline-none focus:ring-2 focus:ring-pink-300 transition-all shadow-inner bg-white/90 backdrop-blur-sm focus:bg-white" />
                    </div>
                </div>



                    ${state.activeTab === 'home' ? renderHome() : ''}
                    ${state.activeTab === 'categories' ? renderCategories() : ''}
                    ${state.activeTab === 'messages' ? renderMessages() : ''}
                    ${state.activeTab === 'profile' ? renderProfile() : ''}

                    <!--Bottom Nav-->
                    <div class="bg-white/90 backdrop-blur-lg border-t p-2 flex justify-around sticky bottom-0 z-30 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] transition-transform duration-300">
                        <button onclick="switchTab('home')" class="flex flex-col items-center gap-1 p-2 transition-all duration-300 active:scale-90 ${state.activeTab === 'home' ? 'text-pink-600 scale-110' : 'text-gray-400'}">
                            <i data-lucide="home" class="w-6 h-6"></i>
                            <span class="text-xs font-medium">Home</span>
                        </button>
                        <button onclick="switchTab('categories')" class="flex flex-col items-center gap-1 p-2 transition-all duration-300 active:scale-90 ${state.activeTab === 'categories' ? 'text-pink-600 scale-110' : 'text-gray-400'}">
                            <i data-lucide="layout-grid" class="w-6 h-6"></i>
                            <span class="text-xs font-medium">Categories</span>
                        </button>
                        <button onclick="switchTab('messages')" class="flex flex-col items-center gap-1 p-2 transition-all duration-300 active:scale-90 ${state.activeTab === 'messages' ? 'text-pink-600 scale-110' : 'text-gray-400'} relative">
                            <i data-lucide="message-circle" class="w-6 h-6"></i>
                            ${state.unreadCount > 0 ? `<span class="absolute top-0 right-0 bg-red-500 text-white text-[10px] rounded-full w-4 h-4 flex items-center justify-center font-bold">${state.unreadCount}</span>` : ''}
                            <span class="text-xs font-medium">Messages</span>
                        </button>
                        <button onclick="switchTab('profile')" class="flex flex-col items-center gap-1 p-2 transition-all duration-300 active:scale-90 ${state.activeTab === 'profile' ? 'text-pink-600 scale-110' : 'text-gray-400'}">
                            <i data-lucide="user" class="w-6 h-6"></i>
                            <span class="text-xs font-medium">Profile</span>
                        </button>
                    </div>

                    <!--Support Button-->
                    <button onclick='showOrderOptions({name: "Support", price: 0}, "support")' class="fixed bottom-20 right-4 w-14 h-14 bg-green-600 border-2 border-white text-white rounded-full shadow-lg flex items-center justify-center z-40 hover:bg-green-700 hover:scale-110 transition-all active:scale-90 animate-fade-in-up">
                        <i data-lucide="message-circle" class="w-6 h-6"></i>
                    </button>

                    <!--Menu Drawer-->
                ${state.showMenu ? `
                        <div class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 animate-fade-in" onclick="toggleMenu()">
                            <div class="bg-white w-80 h-full shadow-2xl overflow-y-auto animate-slide-in-right" onclick="event.stopPropagation()">
                                <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-6 relative overflow-hidden">
                                    <div class="absolute inset-0 bg-white/10 blur-xl"></div>
                                    <div class="flex items-center justify-between mb-4 relative z-10">
                                        <h2 class="text-xl font-bold brand-text tracking-widest">JB'S COLLECTION</h2>
                                        <button onclick="toggleMenu()" class="p-2 hover:rotate-90 transition-transform active:scale-90"><i data-lucide="x" class="w-6 h-6"></i></button>
                                    </div>
                                    <p class="text-sm opacity-90 relative z-10">Luxury Fashion</p>
                                </div>
                                <div class="p-4 border-b">
                                    <div class="grid grid-cols-2 gap-4">
                                        <button onclick="switchTab('home'); toggleMenu();" class="p-3 bg-gray-50 rounded-lg text-center hover:bg-pink-50 hover:text-pink-600 transition-all active:scale-95">
                                            <i data-lucide="home" class="w-6 h-6 mx-auto mb-2"></i>
                                            <span class="text-xs font-bold">Home</span>
                                        </button>
                                        <button onclick="switchTab('favorites'); toggleMenu();" class="p-3 bg-gray-50 rounded-lg text-center hover:bg-pink-50 hover:text-pink-600 transition-all active:scale-95">
                                            <i data-lucide="heart" class="w-6 h-6 mx-auto mb-2"></i>
                                            <span class="text-xs font-bold">Favorites</span>
                                        </button>
                                        <button onclick="switchTab('profile'); toggleMenu();" class="p-3 bg-gray-50 rounded-lg text-center hover:bg-pink-50 hover:text-pink-600 transition-all active:scale-95">
                                            <i data-lucide="user" class="w-6 h-6 mx-auto mb-2"></i>
                                            <span class="text-xs font-bold">Profile</span>
                                        </button>
                                        <button onclick='showOrderOptions({name: "Support", price: 0}, "support"); toggleMenu()' class="p-3 bg-gray-50 rounded-lg text-center hover:bg-pink-50 hover:text-pink-600 transition-all active:scale-95">
                                            <i data-lucide="help-circle" class="w-6 h-6 mx-auto mb-2"></i>
                                            <span class="text-xs font-bold">Support</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="p-4">
                                    <h3 class="font-bold text-gray-700 mb-3 ml-1">Shop by Category</h3>
                                    <div class="space-y-1">
                                    ${categories.map((cat, i) => `
                                        <button onclick="selectCategory('${cat.id}'); toggleMenu();" class="w-full text-left p-2 hover:bg-gray-50 rounded-lg flex items-center gap-4 transition-all group active:scale-98" style="animation: fadeInUp 0.3s ease-out ${i * 50}ms backwards">
                                            <img src="${cat.image}" class="w-10 h-10 rounded-full object-cover border group-hover:border-pink-500 transition-colors">
                                            <span class="font-medium group-hover:text-pink-600 transition-colors">${cat.name}</span>
                                        </button>
                                    `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    ` : ''
                }

                    <!--Product Modal-->
                ${state.selectedProduct ? (() => {
                    const product = products.find(p => p.id === state.selectedProduct);
                    return `
                            <div class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-end sm:items-center sm:justify-center p-0 sm:p-4 animate-fade-in" onclick="closeProductModal(event)">
                                <div class="bg-white rounded-t-3xl sm:rounded-3xl w-full sm:max-w-xlg sm:w-[500px] max-h-[90vh] overflow-y-auto animate-slide-in-up" onclick="event.stopPropagation()">
                                    <div class="sticky top-0 bg-white/90 backdrop-blur-sm border-b p-4 flex items-center justify-between z-10 transition-colors">
                                        <h2 class="text-lg font-bold line-clamp-1">${product.name}</h2>
                                        <button onclick="closeProductModal()" class="p-2 hover:bg-gray-100 rounded-full active:scale-90 transition-transform"><i data-lucide="x" class="w-6 h-6"></i></button>
                                    </div>
                                    <div class="p-0">
                                        <div class="h-80 bg-gray-100 relative group">
                                            <img src="${product.image}" class="w-full h-full object-cover">
                                        </div>
                                        <div class="p-6">
                                            <h3 class="text-2xl font-bold mb-2">${product.name}</h3>
                                            <div class="flex items-center gap-2 mb-4">
                                                <i data-lucide="star" class="w-5 h-5 fill-yellow-400 text-yellow-400"></i>
                                                <span class="font-medium">${product.rating}</span>
                                                <span class="text-gray-500">(${product.reviews} reviews)</span>
                                            </div>
                                            <div class="text-3xl font-bold text-pink-600 mb-6">${formatMoney(product.price)}</div>
                                            <div class="mb-6">
                                                <h4 class="font-bold mb-3">Select Size:</h4>
                                                <div class="grid grid-cols-4 gap-2">
                                                    ${product.sizes.map(size => `
                                                        <button onclick="selectSize('${size}')" class="py-3 px-4 border-2 rounded-lg font-medium transition-all active:scale-95 ${state.selectedSize === size ? 'border-pink-500 bg-pink-50 text-pink-600' : 'border-gray-200 hover:border-pink-300'}">
                                                            ${size}
                                                        </button>
                                                    `).join('')}
                                                </div>
                                            </div>
                                            <button onclick="addToCartFromModal()" class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-4 rounded-lg font-bold text-lg shadow-lg mb-3 hover:shadow-xl active:scale-95 transition-all">
                                                Add to Cart
                                            </button>
                                            <button onclick='showOrderOptions(${JSON.stringify(product).replace(/'/g, "&#39;")}, "buy")' class="w-full bg-white border-2 border-pink-500 text-pink-600 py-4 rounded-lg font-bold text-lg hover:bg-pink-50 active:scale-95 transition-all">
                                                BUY NOW
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                })() : ''
                }

                    <!--Cart Modal-->
                ${state.showCart ? `
                        <div class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-end sm:items-center sm:justify-center p-0 sm:p-4 animate-fade-in" onclick="closeCart(event)">
                            <div class="bg-white rounded-t-3xl sm:rounded-3xl w-full sm:max-w-lg sm:w-[500px] max-h-[90vh] overflow-y-auto animate-slide-in-up" onclick="event.stopPropagation()">
                                <div class="sticky top-0 bg-white/90 backdrop-blur-sm border-b p-4 flex items-center justify-between z-10">
                                    <h2 class="text-lg font-bold">Shopping Cart (${state.cart.length})</h2>
                                    <button onclick="closeCart()" class="p-2 hover:bg-gray-100 rounded-full active:scale-90 transition-transform"><i data-lucide="x" class="w-6 h-6"></i></button>
                                </div>
                                <div class="p-4">
                                    ${state.cart.length === 0 ? `
                                        <div class="text-center py-16 animate-fade-in-up">
                                            <i data-lucide="shopping-cart" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                                            <p class="text-gray-500">Your cart is empty</p>
                                        </div>
                                    ` : `
                                        <div class="space-y-4 mb-4">
                                            ${state.cart.map((item, i) => `
                                                <div class="flex gap-4 bg-gray-50 p-4 rounded-lg animate-fade-in-up" style="animation-delay: ${i * 50}ms">
                                                    <img src="${getImg(item)}" class="w-20 h-20 rounded-lg object-cover flex-shrink-0">
                                                    <div class="flex-1">
                                                        <h3 class="font-semibold mb-1 line-clamp-1">${item.name}</h3>
                                                        <p class="text-sm text-gray-500 mb-2">Size: ${item.selectedSize}</p>
                                                        <div class="flex items-center justify-between">
                                                            <span class="font-bold text-pink-600">${formatMoney(item.price)}</span>
                                                            <div class="flex items-center gap-2">
                                                                <button onclick="updateQuantity(${item.id}, '${item.selectedSize}', -1)" class="w-8 h-8 bg-white rounded-full flex items-center justify-center shadow-sm border hover:bg-gray-50 active:scale-90 transition-transform">
                                                                    <i data-lucide="minus" class="w-4 h-4"></i>
                                                                </button>
                                                                <span class="w-8 text-center font-medium">${item.quantity}</span>
                                                                <button onclick="updateQuantity(${item.id}, '${item.selectedSize}', 1)" class="w-8 h-8 bg-white rounded-full flex items-center justify-center shadow-sm border hover:bg-gray-50 active:scale-90 transition-transform">
                                                                    <i data-lucide="plus" class="w-4 h-4"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <button onclick="removeFromCart(${item.id}, '${item.selectedSize}')" class="text-red-500 p-2 hover:bg-red-50 rounded-full h-fit active:scale-90 transition-transform">
                                                        <i data-lucide="trash-2" class="w-5 h-5"></i>
                                                    </button>
                                                </div>
                                            `).join('')}
                                        </div>
                                        <div class="border-t pt-4 mb-4">
                                            <div class="flex items-center justify-between mb-4">
                                                <span class="text-lg font-bold">Total:</span>
                                                <span class="text-2xl font-bold text-pink-600">${formatMoney(getTotalPrice())}</span>
                                            </div>
                                            <button onclick='showOrderOptions({name: "Cart Items", price: ${getTotalPrice()}}, "order")' class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-4 rounded-lg font-bold text-lg shadow-lg hover:shadow-xl active:scale-95 transition-all">
                                                ORDER NOW
                                            </button>
                                        </div>
                                    `}
                                </div>
                            </div>
                        </div>
                    ` : ''
                }

                    <!--Order Confirmation Modal-->
                ${state.showOrderOptions ? `
                        <div class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[60] flex items-center justify-center p-4 animate-fade-in" onclick="state.showOrderOptions = false; render();">
                            <div class="bg-white rounded-2xl p-6 max-w-sm w-full shadow-2xl transform scale-100 transition-all animate-fade-in-up" onclick="event.stopPropagation()">
                                <h3 class="text-xl font-bold mb-4 text-center">Confirm Order</h3>
                                <p class="text-gray-600 text-center mb-6">Place this order and chat with admin?</p>
                                <div class="space-y-3">
                                    <button onclick="placeOrder()" class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-3 transition-all transform hover:scale-105 active:scale-95 shadow-md">
                                        <i data-lucide="check-circle" class="w-6 h-6"></i>
                                        Confirm Order
                                    </button>
                                    <button onclick="state.showOrderOptions = false; render();" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 rounded-xl font-medium transition-all active:scale-95">
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    ` : ''
                }

                    <!--Auth Modal-->
                ${state.showAuthModal ? `
                        <div class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[60] flex items-center justify-center p-4 animate-fade-in" onclick="state.showAuthModal = false; render();">
                            <div class="bg-white rounded-2xl p-6 max-w-sm w-full shadow-2xl transform scale-100 transition-all animate-fade-in-up" onclick="event.stopPropagation()">
                                <h3 class="text-2xl font-bold mb-6 text-center">${state.authMode === 'login' ? 'Welcome Back!' : 'Create Account'}</h3>
                                
                                <form onsubmit="event.preventDefault(); ${state.authMode === 'login' ? 'handleLogin' : 'handleSignup'}(event);" class="space-y-4">
                                    ${state.authMode === 'signup' ? `
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                                            <input type="text" name="name" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" placeholder="Your name">
                                        </div>
                                    ` : ''}
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                        <input type="email" name="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" placeholder="your@email.com">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                        <input type="password" name="password" required minlength="6" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                    </div>
                                    
                                    <button type="submit" class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-bold hover:shadow-lg active:scale-95 transition-all">
                                        ${state.authMode === 'login' ? 'Login' : 'Sign Up'}
                                    </button>
                                </form>
                                
                                <div class="mt-4 text-center">
                                    <button onclick="state.authMode = state.authMode === 'login' ? 'signup' : 'login'; render();" class="text-pink-600 font-medium hover:underline">
                                        ${state.authMode === 'login' ? "Don't have an account? Sign up" : 'Already have an account? Login'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    ` : ''
                }

                    <!--Chat Modal-->
                ${state.selectedOrder ? (() => {
                    const order = state.orders.find(o => o.id === state.selectedOrder);
                    if (!order) return '';

                    return `
                        <div class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-end sm:items-center sm:justify-center p-0 sm:p-4 animate-fade-in" onclick="closeChat(event)">
                            <div class="bg-white rounded-t-3xl sm:rounded-3xl w-full sm:max-w-lg h-[90vh] flex flex-col animate-slide-in-up" onclick="event.stopPropagation()">
                                <!-- Header -->
                                <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-4 rounded-t-3xl sm:rounded-t-3xl flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <img src="${order.product?.image || order.items?.[0]?.image}" class="w-12 h-12 rounded-lg object-cover">
                                        <div>
                                            <h3 class="font-bold">${order.product?.name || 'Order Chat'}</h3>
                                            <p class="text-xs opacity-90">Status: ${order.status}</p>
                                        </div>
                                    </div>
                                    <button onclick="closeChat()" class="p-2 hover:bg-white/20 rounded-full transition-colors">
                                        <i data-lucide="x" class="w-6 h-6"></i>
                                    </button>
                                </div>

                                <!-- Messages -->
                                <div class="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50" id="chatMessages">
                                    ${!order.messages || order.messages.length === 0 ? `
                                        <div class="text-center py-8 text-gray-500">
                                            <i data-lucide="message-circle" class="w-12 h-12 mx-auto mb-2 text-gray-300"></i>
                                            <p>No messages yet. Start the conversation!</p>
                                        </div>
                                    ` : order.messages.map((msg, i) => `
                                        <div class="flex ${msg.isAdmin ? 'justify-start' : 'justify-end'} animate-fade-in-up" style="animation-delay: ${i * 50}ms">
                                            <div class="max-w-[75%] ${msg.isAdmin ? 'bg-white' : 'bg-gradient-to-r from-pink-500 to-purple-600 text-white'} rounded-2xl p-3 shadow-sm">
                                                <p class="text-sm font-medium mb-1 ${msg.isAdmin ? 'text-pink-600' : 'text-white/90'}">${msg.senderName}</p>
                                                <p class="text-sm">${msg.text}</p>
                                                <p class="text-xs mt-1 ${msg.isAdmin ? 'text-gray-400' : 'text-white/70'}">${msg.timestamp ? new Date(msg.timestamp.seconds * 1000).toLocaleTimeString() : 'Just now'}</p>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>

                                <!-- Admin Controls -->
                                ${state.isAdmin ? `
                                    <div class="border-t p-3 bg-gray-50">
                                        <div class="flex gap-2">
                                            <button onclick="updateOrderStatus('${order.id}', 'confirmed')" class="flex-1 bg-green-500 text-white py-2 px-3 rounded-lg text-sm font-bold hover:bg-green-600 active:scale-95 transition-all">
                                                ‚úì Confirm
                                            </button>
                                            <button onclick="updateOrderStatus('${order.id}', 'cancelled')" class="flex-1 bg-red-500 text-white py-2 px-3 rounded-lg text-sm font-bold hover:bg-red-600 active:scale-95 transition-all">
                                                ‚úó Cancel
                                            </button>
                                            <button onclick="updateOrderStatus('${order.id}', 'completed')" class="flex-1 bg-blue-500 text-white py-2 px-3 rounded-lg text-sm font-bold hover:bg-blue-600 active:scale-95 transition-all">
                                                ‚úì Complete
                                            </button>
                                        </div>
                                    </div>
                                ` : ''}

                                <!-- Message Input -->
                                <div class="border-t p-4 bg-white rounded-b-3xl sm:rounded-b-3xl">
                                    <form onsubmit="event.preventDefault(); sendMessage('${order.id}', event);" class="flex gap-2">
                                        <input type="text" name="message" required placeholder="Type a message..." class="flex-1 px-4 py-3 border border-gray-300 rounded-full focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                        <button type="submit" class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-3 rounded-full hover:shadow-lg active:scale-95 transition-all">
                                            <i data-lucide="send" class="w-5 h-5"></i>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    `;
                })() : ''}
                </div>
            `;
            if (window.lucide) lucide.createIcons();

            // Scroll chat to bottom
            setTimeout(() => {
                const chatEl = document.getElementById('chatMessages');
                if (chatEl) chatEl.scrollTop = chatEl.scrollHeight;
            }, 100);
        }

        // Auth Form Handlers
        function handleLogin(event) {
            const form = event.target;
            const email = form.email.value;
            const password = form.password.value;
            login(email, password);
        }

        function handleSignup(event) {
            const form = event.target;
            const name = form.name.value;
            const email = form.email.value;
            const password = form.password.value;
            signup(email, password, name);
        }

        // Helper Functions
        function showOrderOptions(product, context = 'buy') {
            state.orderProduct = { ...product, context };
            state.showOrderOptions = true;
            render();
        }

        function selectOrder(orderId) {
            state.selectedOrder = orderId;

            // Mark messages as read
            if (state.currentUser) {
                const db = firebase.firestore();
                const updateField = state.isAdmin ? 'unreadByAdmin' : 'unreadByCustomer';
                db.collection('orders').doc(orderId).update({
                    [updateField]: false
                }).then(() => loadUserData());
            }

            render();
        }

        function closeChat(event) {
            if (event) event.stopPropagation();
            state.selectedOrder = null;
            render();
        }

        async function sendMessage(orderId, event) {
            const form = event.target;
            const messageText = form.message.value.trim();

            if (!messageText || !state.currentUser) return;

            const db = firebase.firestore();
            const orderRef = db.collection('orders').doc(orderId);

            const newMessage = {
                senderId: state.currentUser.uid,
                senderName: state.currentUser.displayName || state.currentUser.email,
                text: messageText,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                isAdmin: state.isAdmin
            };

            try {
                await orderRef.update({
                    messages: firebase.firestore.FieldValue.arrayUnion(newMessage),
                    unreadByAdmin: !state.isAdmin,
                    unreadByCustomer: state.isAdmin
                });

                form.reset();
                await loadUserData();
                render();
            } catch (error) {
                alert('Failed to send message: ' + error.message);
            }
        }

        async function updateOrderStatus(orderId, newStatus) {
            if (!state.isAdmin) return;

            const db = firebase.firestore();

            try {
                await db.collection('orders').doc(orderId).update({
                    status: newStatus
                });

                showToast(`Order ${newStatus}!`);
                await loadUserData();
                render();
            } catch (error) {
                alert('Failed to update status: ' + error.message);
            }
        }

        function switchTab(tab) { state.activeTab = tab; state.viewingCategoryPage = false; render(); }
        function selectCategory(categoryId) {
            if (categoryId === 'all') { state.selectedCategory = 'all'; state.viewingCategoryPage = false; }
            else { state.selectedCategory = categoryId; state.activeTab = 'home'; state.viewingCategoryPage = true; }
            render();
        }
        function backToHome() { state.viewingCategoryPage = false; state.selectedCategory = 'all'; render(); }
        function selectProduct(productId) { state.selectedProduct = productId; state.selectedSize = ''; render(); }
        function closeProductModal(event) { if (event) event.stopPropagation(); state.selectedProduct = null; render(); }
        function selectSize(size) { state.selectedSize = size; render(); }
        function addToCartFromModal() { const p = products.find(p => p.id === state.selectedProduct); if (p) addToCart(p, state.selectedSize); }
        function toggleCart() { state.showCart = !state.showCart; render(); }
        function closeCart(event) { if (event) event.stopPropagation(); state.showCart = false; render(); }
        function toggleMenu() { state.showMenu = !state.showMenu; render(); }
        function handleSearch(event) { state.searchQuery = event.target.value; render(); }

        render();
    </script>
</body>

</html>